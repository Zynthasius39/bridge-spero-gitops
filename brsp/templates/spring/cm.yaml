---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.configMaps.spring }}
  labels:
    app.kubernetes.io/name: {{ template "brsp.name" . }}
    app.kubernetes.io/component: spring
    helm.sh/chart: {{ template "brsp.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
    tier: backend
data:
  datasourceUrl: jdbc:postgresql://{{ template "postgres.service.name" }}-${BRSP_ENV}-rw{{ template "brsp.service.uriSuffix" . }}:5432/{{ .Values.postgres.initdb.database }}
  datasourceUsername: {{ .Values.postgres.initdb.owner }}
  replicaDatasourceUrl: jdbc:postgresql://{{ template "postgres.service.name" }}-${BRSP_ENV}-ro{{ template "brsp.service.uriSuffix" . }}:5432/{{ .Values.postgres.initdb.database }}
  redisAddress: redis://{{ template "redis.service.name" . }}-${BRSP_ENV}{{ template "brsp.service.uriSuffix" . }}:6379
  zoomRedirectUri: ${BRSP_URL}/api/v1/zoom/oauth/callback
  {{- with (.Values.spring).config }}
{{ toYaml . | indent 2 }}
  {{- end }}
